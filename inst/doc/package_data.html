<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>GeoTox Package Data</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">GeoTox Package Data</h1>



<p>This package includes example data <code>geo_tox_data</code>. Below
is a description of the data and example code for how it was
gathered.</p>
<blockquote>
<p><strong>NOTE:</strong> FIPS codes can change. Since data is being
pulled from various sources, ensure that the FIPS values can be used to
connect data across these sources. For example, in 2022 Connecticut
began the process of going from 8 legacy counties to 9 planning
regions.</p>
</blockquote>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(httk)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>geo_tox_data <span class="ot">&lt;-</span> <span class="fu">list</span>()</span></code></pre></div>
<div id="chemical-data" class="section level1">
<h1>Chemical data</h1>
<div id="exposure-data" class="section level2">
<h2>Exposure data</h2>
<p>Download modeled exposure data from
<a href="https://www.epa.gov/AirToxScreen" target="_blank">AirToxScreen</a>.
Results from AirToxScreen 2019 for a subset of chemicals in North
Carolina counties are included in the package data as
<code>geo_tox_data$exposure</code>.</p>
<blockquote>
<p><strong>NOTE:</strong> The 2020 release does not currently provide a
single file for the exposure national concentration summaries. The 2019
data can be found following the “Previous air toxics assessments”
link.</p>
</blockquote>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="st">&quot;2019_Toxics_Exposure_Concentrations.xlsx&quot;</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(filename)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">&quot;https://www.epa.gov/system/files/documents/2022-12/&quot;</span>, filename),</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  tmp</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>exposure <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(tmp)</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co"># Normalization function</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>min_max_norm <span class="ot">=</span> <span class="cf">function</span>(x) {</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>  min_x <span class="ot">&lt;-</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>  max_x <span class="ot">&lt;-</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  <span class="cf">if</span> (min_x <span class="sc">==</span> max_x) {</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(x))</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>    (x <span class="sc">-</span> min_x) <span class="sc">/</span> (max_x <span class="sc">-</span> min_x)</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>  }</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>}</span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>geo_tox_data<span class="sc">$</span>exposure <span class="ot">&lt;-</span> exposure <span class="sc">|&gt;</span> </span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>  <span class="co"># North Carolina counties</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">==</span> <span class="st">&quot;NC&quot;</span>, <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;0$&quot;</span>, FIPS)) <span class="sc">|&gt;</span> </span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>  <span class="co"># Aggregate chemicals by county</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="fu">c</span>(State<span class="sc">:</span>Tract), <span class="fu">c</span>(mean, sd)), <span class="at">.by =</span> FIPS) <span class="sc">|&gt;</span> </span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>FIPS, <span class="at">names_to =</span> <span class="st">&quot;chemical&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stat =</span> <span class="fu">if_else</span>(<span class="fu">grepl</span>(<span class="st">&quot;_1$&quot;</span>, chemical), <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;sd&quot;</span>),</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>         <span class="at">chemical =</span> <span class="fu">gsub</span>(<span class="st">&#39;.{2}$&#39;</span>, <span class="st">&#39;&#39;</span>, chemical)) <span class="sc">|&gt;</span> </span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> stat) <span class="sc">|&gt;</span> </span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>  <span class="co"># Normalize concentrations</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">norm =</span> <span class="fu">min_max_norm</span>(mean), <span class="at">.by =</span> chemical)</span></code></pre></div>
<div id="get-casrn-and-preferred_name-from-comptox-dashboard" class="section level3">
<h3>Get CASRN and PREFERRED_NAME from CompTox Dashboard</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Copy/paste the chemical names into the batch search field</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co"># https://comptox.epa.gov/dashboard/batch-search</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">cat</span>(geo_tox_data<span class="sc">$</span>exposure <span class="sc">|&gt;</span> <span class="fu">distinct</span>(chemical) <span class="sc">|&gt;</span> <span class="fu">pull</span>(), <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Export results with &quot;CAS-RN&quot; identifiers as a csv file, then process in R</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>exposure_casrn <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;CCD-Batch-Search.csv&quot;</span>,</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>                           <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="fu">filter</span>(DTXSID <span class="sc">!=</span> <span class="st">&quot;N/A&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="co"># Prioritize results based on FOUND_BY status</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>  <span class="fu">arrange</span>(INPUT,</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>          <span class="fu">grepl</span>(<span class="st">&quot;Approved Name&quot;</span>, FOUND_BY),</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>          <span class="fu">grepl</span>(<span class="st">&quot;^Synonym&quot;</span>, FOUND_BY)) <span class="sc">|&gt;</span> </span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  <span class="co"># Keep one result per INPUT</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  <span class="fu">group_by</span>(INPUT) <span class="sc">|&gt;</span> </span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co"># Update exposure data with CompTox Dashboard data</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>geo_tox_data<span class="sc">$</span>exposure <span class="ot">&lt;-</span> geo_tox_data<span class="sc">$</span>exposure <span class="sc">|&gt;</span> </span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>  <span class="fu">inner_join</span>(exposure_casrn, <span class="at">by =</span> <span class="fu">join_by</span>(chemical <span class="sc">==</span> INPUT)) <span class="sc">|&gt;</span> </span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>  <span class="fu">select</span>(FIPS, <span class="at">casn =</span> CASRN, <span class="at">chnm =</span> PREFERRED_NAME, mean, sd, norm)</span></code></pre></div>
</div>
</div>
<div id="ice-chts-data" class="section level2">
<h2>ICE cHTS data</h2>
<p>Use <a href="https://ice.ntp.niehs.nih.gov/" target="_blank">ICE</a>
cHTS data to identify active chemicals for a given set of assays.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>get_cHTS_hits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">assays =</span> <span class="cn">NULL</span>, <span class="at">chemids =</span> <span class="cn">NULL</span>) {</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  </span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(assays) <span class="sc">&amp;</span> <span class="fu">is.null</span>(chemids)) {</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Must provide at least one of &#39;assays&#39; or &#39;chemids&#39;&quot;</span>)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  }</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  </span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="co"># Format query parameters</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  req_params <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  </span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(assays)) {</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.list</span>(assays)) assays <span class="ot">&lt;-</span> <span class="fu">as.list</span>(assays)</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>    req_params<span class="sc">$</span>assays <span class="ot">&lt;-</span> assays</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>  }</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>  </span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(chemids)) {</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.list</span>(chemids)) chemids <span class="ot">&lt;-</span> <span class="fu">as.list</span>(chemids)</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>    req_params<span class="sc">$</span>chemids <span class="ot">&lt;-</span> chemids</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>  }</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>  </span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>  <span class="co"># Query ICE API</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>  resp <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">&quot;https://ice.ntp.niehs.nih.gov/api/v1/search&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>    <span class="fu">req_body_json</span>(req_params) <span class="sc">|&gt;</span> </span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>    <span class="fu">req_perform</span>()</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>  </span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>  <span class="cf">if</span> (resp<span class="sc">$</span>status_code <span class="sc">!=</span> <span class="dv">200</span>) {</span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Failed to retrieve data from ICE API&quot;</span>)</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>  }</span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>  </span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>  <span class="co"># Return active chemicals</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>  result <span class="ot">&lt;-</span> resp <span class="sc">|&gt;</span> <span class="fu">resp_body_json</span>() <span class="sc">|&gt;</span> <span class="fu">pluck</span>(<span class="st">&quot;endPoints&quot;</span>)</span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a>  </span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>  fields <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;assay&quot;</span>, <span class="st">&quot;casrn&quot;</span>, <span class="st">&quot;dtxsid&quot;</span>, <span class="st">&quot;substanceName&quot;</span>,</span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a>              <span class="st">&quot;endpoint&quot;</span>, <span class="st">&quot;value&quot;</span>)</span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>  </span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a>  <span class="fu">map</span>(fields, \(x) <span class="fu">map_chr</span>(result, x)) <span class="sc">|&gt;</span> </span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a>    <span class="fu">set_names</span>(fields) <span class="sc">|&gt;</span></span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a>    <span class="fu">bind_cols</span>() <span class="sc">|&gt;</span> </span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a>    <span class="fu">filter</span>(endpoint <span class="sc">==</span> <span class="st">&quot;Call&quot;</span>, value <span class="sc">==</span> <span class="st">&quot;Active&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(endpoint, value)) <span class="sc">|&gt;</span> </span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a>}</span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a>assays <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;APR_HepG2_p53Act_1h_dn&quot;</span>,</span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a>            <span class="st">&quot;APR_HepG2_p53Act_1h_up&quot;</span>,</span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a>            <span class="st">&quot;APR_HepG2_p53Act_24h_dn&quot;</span>,</span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a>            <span class="st">&quot;APR_HepG2_p53Act_24h_up&quot;</span>,</span>
<span id="cb4-47"><a href="#cb4-47" tabindex="-1"></a>            <span class="st">&quot;APR_HepG2_p53Act_72h_dn&quot;</span>,</span>
<span id="cb4-48"><a href="#cb4-48" tabindex="-1"></a>            <span class="st">&quot;APR_HepG2_p53Act_72h_up&quot;</span>,</span>
<span id="cb4-49"><a href="#cb4-49" tabindex="-1"></a>            <span class="st">&quot;ATG_p53_CIS_up&quot;</span>,</span>
<span id="cb4-50"><a href="#cb4-50" tabindex="-1"></a>            <span class="st">&quot;TOX21_DT40&quot;</span>,</span>
<span id="cb4-51"><a href="#cb4-51" tabindex="-1"></a>            <span class="st">&quot;TOX21_DT40_100&quot;</span>,</span>
<span id="cb4-52"><a href="#cb4-52" tabindex="-1"></a>            <span class="st">&quot;TOX21_DT40_657&quot;</span>,</span>
<span id="cb4-53"><a href="#cb4-53" tabindex="-1"></a>            <span class="st">&quot;TOX21_ELG1_LUC_Agonist&quot;</span>,</span>
<span id="cb4-54"><a href="#cb4-54" tabindex="-1"></a>            <span class="st">&quot;TOX21_H2AX_HTRF_CHO_Agonist_ratio&quot;</span>,</span>
<span id="cb4-55"><a href="#cb4-55" tabindex="-1"></a>            <span class="st">&quot;TOX21_p53_BLA_p1_ratio&quot;</span>,</span>
<span id="cb4-56"><a href="#cb4-56" tabindex="-1"></a>            <span class="st">&quot;TOX21_p53_BLA_p2_ratio&quot;</span>,</span>
<span id="cb4-57"><a href="#cb4-57" tabindex="-1"></a>            <span class="st">&quot;TOX21_p53_BLA_p3_ratio&quot;</span>,</span>
<span id="cb4-58"><a href="#cb4-58" tabindex="-1"></a>            <span class="st">&quot;TOX21_p53_BLA_p4_ratio&quot;</span>,</span>
<span id="cb4-59"><a href="#cb4-59" tabindex="-1"></a>            <span class="st">&quot;TOX21_p53_BLA_p5_ratio&quot;</span>)</span>
<span id="cb4-60"><a href="#cb4-60" tabindex="-1"></a></span>
<span id="cb4-61"><a href="#cb4-61" tabindex="-1"></a>chemids <span class="ot">&lt;-</span> <span class="fu">unique</span>(geo_tox_data<span class="sc">$</span>exposure<span class="sc">$</span>casn)</span>
<span id="cb4-62"><a href="#cb4-62" tabindex="-1"></a>  </span>
<span id="cb4-63"><a href="#cb4-63" tabindex="-1"></a>cHTS_hits_API <span class="ot">&lt;-</span> <span class="fu">get_cHTS_hits</span>(<span class="at">assays =</span> assays, <span class="at">chemids =</span> chemids)</span></code></pre></div>
</div>
<div id="dose-response-data" class="section level2">
<h2>Dose-response data</h2>
<p>Use the ICE API to retrieve dose-response data for selected assays
and chemicals.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>get_ICE_dose_resp <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">assays =</span> <span class="cn">NULL</span>, <span class="at">chemids =</span> <span class="cn">NULL</span>) {</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  </span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(assays) <span class="sc">&amp;</span> <span class="fu">is.null</span>(chemids)) {</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Must provide at least one of &#39;assays&#39; or &#39;chemids&#39;&quot;</span>)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  }</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  </span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="co"># Format query parameters</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  req_params <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  </span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(assays)) {</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.list</span>(assays)) assays <span class="ot">&lt;-</span> <span class="fu">as.list</span>(assays)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>    req_params<span class="sc">$</span>assays <span class="ot">&lt;-</span> assays</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>  }</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>  </span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(chemids)) {</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.list</span>(chemids)) chemids <span class="ot">&lt;-</span> <span class="fu">as.list</span>(chemids)</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>    req_params<span class="sc">$</span>chemids <span class="ot">&lt;-</span> chemids</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>  }</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>  </span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>  <span class="co"># Query ICE API</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>  resp <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">&quot;https://ice.ntp.niehs.nih.gov/api/v1/curves&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>    <span class="fu">req_body_json</span>(req_params) <span class="sc">|&gt;</span> </span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>    <span class="fu">req_perform</span>()</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>  </span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>  <span class="cf">if</span> (resp<span class="sc">$</span>status_code <span class="sc">!=</span> <span class="dv">200</span>) {</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Failed to retrieve data from ICE API&quot;</span>)</span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>  }</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>  </span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>  <span class="co"># Return dose-response data</span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>  result <span class="ot">&lt;-</span> resp <span class="sc">|&gt;</span> <span class="fu">resp_body_json</span>() <span class="sc">|&gt;</span> <span class="fu">pluck</span>(<span class="st">&quot;curves&quot;</span>)</span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>  </span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>  <span class="fu">map</span>(result, <span class="cf">function</span>(x) {</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>      <span class="at">endp =</span> x[[<span class="st">&quot;assay&quot;</span>]],</span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a>      <span class="at">casn =</span> x[[<span class="st">&quot;casrn&quot;</span>]],</span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a>      <span class="at">call =</span> x[[<span class="st">&quot;dsstoxsid&quot;</span>]],</span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a>      <span class="at">chnm =</span> x[[<span class="st">&quot;substance&quot;</span>]],</span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a>      <span class="at">call =</span> x[[<span class="st">&quot;call&quot;</span>]],</span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a>      <span class="at">logc =</span> <span class="fu">map_dbl</span>(x[[<span class="st">&quot;concentrationResponses&quot;</span>]], <span class="st">&quot;concentration&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">log10</span>(),</span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a>      <span class="at">resp =</span> <span class="fu">map_dbl</span>(x[[<span class="st">&quot;concentrationResponses&quot;</span>]], <span class="st">&quot;response&quot;</span>)</span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a>    )</span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a>  }) <span class="sc">|&gt;</span> </span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a>}</span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a>assays <span class="ot">&lt;-</span> <span class="fu">unique</span>(cHTS_hits_API<span class="sc">$</span>assay)</span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a>chemids <span class="ot">&lt;-</span> <span class="fu">intersect</span>(cHTS_hits_API<span class="sc">$</span>casrn, geo_tox_data<span class="sc">$</span>exposure<span class="sc">$</span>casn)</span>
<span id="cb5-49"><a href="#cb5-49" tabindex="-1"></a></span>
<span id="cb5-50"><a href="#cb5-50" tabindex="-1"></a>dose_response <span class="ot">&lt;-</span> <span class="fu">get_ICE_dose_resp</span>(<span class="at">assays =</span> assays, <span class="at">chemids =</span> chemids)</span>
<span id="cb5-51"><a href="#cb5-51" tabindex="-1"></a></span>
<span id="cb5-52"><a href="#cb5-52" tabindex="-1"></a><span class="co"># Only keep active calls for assay/chemical combinations</span></span>
<span id="cb5-53"><a href="#cb5-53" tabindex="-1"></a>geo_tox_data<span class="sc">$</span>dose_response <span class="ot">&lt;-</span> dose_response <span class="sc">|&gt;</span> </span>
<span id="cb5-54"><a href="#cb5-54" tabindex="-1"></a>  <span class="fu">filter</span>(call <span class="sc">==</span> <span class="st">&quot;Active&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-55"><a href="#cb5-55" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>call)</span>
<span id="cb5-56"><a href="#cb5-56" tabindex="-1"></a></span>
<span id="cb5-57"><a href="#cb5-57" tabindex="-1"></a><span class="co"># Update dose-response data with CompTox Dashboard data</span></span>
<span id="cb5-58"><a href="#cb5-58" tabindex="-1"></a>geo_tox_data<span class="sc">$</span>dose_response <span class="ot">&lt;-</span> geo_tox_data<span class="sc">$</span>dose_response <span class="sc">|&gt;</span></span>
<span id="cb5-59"><a href="#cb5-59" tabindex="-1"></a>  <span class="fu">inner_join</span>(exposure_casrn, <span class="at">by =</span> <span class="fu">join_by</span>(casn <span class="sc">==</span> CASRN)) <span class="sc">|&gt;</span></span>
<span id="cb5-60"><a href="#cb5-60" tabindex="-1"></a>  <span class="fu">select</span>(endp, casn, <span class="at">chnm =</span> PREFERRED_NAME, logc, resp)</span></code></pre></div>
</div>
</div>
<div id="population-data" class="section level1">
<h1>Population data</h1>
<div id="age" class="section level2">
<h2>Age</h2>
<p>Download age data from the
<a href="https://www.census.gov/" target="_blank">U.S. Census Bureau</a>
by searching for “County Population by Characteristics”. A subset of
data for North Carolina from
<a href="https://www.census.gov/data/datasets/time-series/demo/popest/2010s-counties-detail.html" target="_blank">2019</a>
is included in the package data as <code>geo_tox_data$age</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Data for North Carolina</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;https://www2.census.gov/programs-surveys/popest/datasets/&quot;</span>,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>              <span class="st">&quot;2010-2019/counties/asrh/cc-est2019-alldata-37.csv&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(url, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>geo_tox_data<span class="sc">$</span>age <span class="ot">&lt;-</span> age <span class="sc">|&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="co"># 7/1/2019 population estimate</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="fu">filter</span>(YEAR <span class="sc">==</span> <span class="dv">12</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="co"># Create FIPS</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FIPS =</span> <span class="fu">str_c</span>(STATE, COUNTY)) <span class="sc">|&gt;</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>  <span class="co"># Keep selected columns</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>  <span class="fu">select</span>(FIPS, AGEGRP, TOT_POP)</span></code></pre></div>
</div>
<div id="obesity" class="section level2">
<h2>Obesity</h2>
<p>Follow the “Data Portal” link from
<a href="https://www.cdc.gov/places/index.html" target="_blank">CDC
PLACES</a> and search for “places county data”. Go to the desired
dataset webpage, for example
<a href="https://data.cdc.gov/500-Cities-Places/PLACES-County-Data-GIS-Friendly-Format-2020-releas/mssc-ksj7/about_data" target="_blank">2020
county data</a>, and download the data by selecting Actions → API →
Download file. A subset of data for North Carolina is included in the
package data as <code>geo_tox_data$obesity</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>places <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;PLACES__County_Data__GIS_Friendly_Format___2020_release.csv&quot;</span>,</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>                   <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co"># Convert confidence interval to standard deviation</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>extract_SD <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  range <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_split_1</span>(<span class="fu">str_sub</span>(x, <span class="dv">2</span>, <span class="sc">-</span><span class="dv">2</span>), <span class="st">&quot;,&quot;</span>))</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  <span class="fu">diff</span>(range) <span class="sc">/</span> <span class="fl">3.92</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>}</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>geo_tox_data<span class="sc">$</span>obesity <span class="ot">&lt;-</span> places <span class="sc">|&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>  <span class="co"># North Carolina Counties</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>  <span class="fu">filter</span>(StateAbbr <span class="sc">==</span> <span class="st">&quot;NC&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>  <span class="co"># Select obesity data</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">FIPS =</span> CountyFIPS, OBESITY_CrudePrev, OBESITY_Crude95CI) <span class="sc">|&gt;</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>  <span class="co"># Change confidence interval to standard deviation</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OBESITY_SD =</span> <span class="fu">extract_SD</span>(OBESITY_Crude95CI)) <span class="sc">|&gt;</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>OBESITY_Crude95CI)</span></code></pre></div>
</div>
<div id="steady-state-plasma-concentration-c_ss" class="section level2">
<h2>Steady-state plasma concentration (<code>C_ss</code>)</h2>
<p>Use <code>httk</code> to generate <code>C_ss</code> values for
combinations of age group and weight status for each chemical. The
generation of these values is a time-intensive step, so one approach is
to generate populations of <code>C_ss</code> values initially and then
sample them later.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2345</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>n_samples <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co"># Get CASN for which httk simulation is possible. Try using load_dawson2021,</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co"># load_sipes2017, or load_pradeep2020 to increase availability.</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="fu">load_sipes2017</span>()</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>casn <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">unique</span>(geo_tox_data<span class="sc">$</span>dose_response<span class="sc">$</span>casn),</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>                  <span class="fu">get_cheminfo</span>(<span class="at">suppress.messages =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co"># Define population demographics for httk simulation</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>pop_demo <span class="ot">&lt;-</span> <span class="fu">cross_join</span>(</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">age_group =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">10</span>), <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">15</span>),</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>                          <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">30</span>), <span class="fu">c</span>(<span class="dv">31</span>, <span class="dv">40</span>), <span class="fu">c</span>(<span class="dv">41</span>, <span class="dv">50</span>),</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>                          <span class="fu">c</span>(<span class="dv">51</span>, <span class="dv">60</span>), <span class="fu">c</span>(<span class="dv">61</span>, <span class="dv">70</span>), <span class="fu">c</span>(<span class="dv">71</span>, <span class="dv">100</span>))),</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">weight =</span> <span class="fu">c</span>(<span class="st">&quot;Normal&quot;</span>, <span class="st">&quot;Obese&quot;</span>))) <span class="sc">|&gt;</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>  <span class="co"># Create column of lower age_group values</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_min =</span> age_group[<span class="dv">1</span>]) <span class="sc">|&gt;</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="co"># Create wrapper function around httk steps</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>simulate_css <span class="ot">&lt;-</span> <span class="cf">function</span>(chem.cas, agelim_years, weight_category,</span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>                         samples, <span class="at">verbose =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>  </span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>  <span class="cf">if</span> (verbose) {</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>    <span class="fu">cat</span>(chem.cas,</span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>        <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, <span class="fu">paste</span>(agelim_years, <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot;)&quot;</span>),</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>        weight_category,</span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>        <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>  }</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>  </span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>  httkpop <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;vi&quot;</span>,</span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a>                  <span class="at">gendernum =</span> <span class="cn">NULL</span>,</span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a>                  <span class="at">agelim_years =</span> agelim_years,</span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a>                  <span class="at">agelim_months =</span> <span class="cn">NULL</span>,</span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a>                  <span class="at">weight_category =</span> weight_category,</span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a>                  <span class="at">reths =</span> <span class="fu">c</span>(</span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a>                    <span class="st">&quot;Mexican American&quot;</span>,</span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a>                    <span class="st">&quot;Other Hispanic&quot;</span>,</span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a>                    <span class="st">&quot;Non-Hispanic White&quot;</span>,</span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a>                    <span class="st">&quot;Non-Hispanic Black&quot;</span>,</span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a>                    <span class="st">&quot;Other&quot;</span></span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a>                  ))</span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a>  </span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a>  css <span class="ot">&lt;-</span> <span class="fu">try</span>(</span>
<span id="cb8-46"><a href="#cb8-46" tabindex="-1"></a>    <span class="fu">suppressWarnings</span>({</span>
<span id="cb8-47"><a href="#cb8-47" tabindex="-1"></a>      mcs <span class="ot">&lt;-</span> <span class="fu">create_mc_samples</span>(<span class="at">chem.cas =</span> chem.cas,</span>
<span id="cb8-48"><a href="#cb8-48" tabindex="-1"></a>                               <span class="at">samples =</span> samples,</span>
<span id="cb8-49"><a href="#cb8-49" tabindex="-1"></a>                               <span class="at">httkpop.generate.arg.list =</span> httkpop,</span>
<span id="cb8-50"><a href="#cb8-50" tabindex="-1"></a>                               <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-51"><a href="#cb8-51" tabindex="-1"></a>      </span>
<span id="cb8-52"><a href="#cb8-52" tabindex="-1"></a>      <span class="fu">calc_analytic_css</span>(<span class="at">chem.cas =</span> chem.cas,</span>
<span id="cb8-53"><a href="#cb8-53" tabindex="-1"></a>                        <span class="at">parameters =</span> mcs,</span>
<span id="cb8-54"><a href="#cb8-54" tabindex="-1"></a>                        <span class="at">model =</span> <span class="st">&quot;3compartmentss&quot;</span>,</span>
<span id="cb8-55"><a href="#cb8-55" tabindex="-1"></a>                        <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-56"><a href="#cb8-56" tabindex="-1"></a>    }),</span>
<span id="cb8-57"><a href="#cb8-57" tabindex="-1"></a>    <span class="at">silent =</span> <span class="cn">TRUE</span></span>
<span id="cb8-58"><a href="#cb8-58" tabindex="-1"></a>  )</span>
<span id="cb8-59"><a href="#cb8-59" tabindex="-1"></a>  </span>
<span id="cb8-60"><a href="#cb8-60" tabindex="-1"></a>  <span class="co"># Return</span></span>
<span id="cb8-61"><a href="#cb8-61" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is</span>(css, <span class="st">&quot;try-error&quot;</span>)) {</span>
<span id="cb8-62"><a href="#cb8-62" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste0</span>(<span class="st">&quot;simulate_css failed to generate data for CASN &quot;</span>, chem.cas))</span>
<span id="cb8-63"><a href="#cb8-63" tabindex="-1"></a>    <span class="fu">list</span>(<span class="cn">NA</span>)</span>
<span id="cb8-64"><a href="#cb8-64" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb8-65"><a href="#cb8-65" tabindex="-1"></a>    <span class="fu">list</span>(css)</span>
<span id="cb8-66"><a href="#cb8-66" tabindex="-1"></a>  }</span>
<span id="cb8-67"><a href="#cb8-67" tabindex="-1"></a>}</span>
<span id="cb8-68"><a href="#cb8-68" tabindex="-1"></a></span>
<span id="cb8-69"><a href="#cb8-69" tabindex="-1"></a><span class="co"># Simulate `C_ss` values</span></span>
<span id="cb8-70"><a href="#cb8-70" tabindex="-1"></a>simulated_css <span class="ot">&lt;-</span> <span class="fu">map</span>(casn, <span class="cf">function</span>(chem.cas) {</span>
<span id="cb8-71"><a href="#cb8-71" tabindex="-1"></a>  pop_demo <span class="sc">|&gt;</span></span>
<span id="cb8-72"><a href="#cb8-72" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-73"><a href="#cb8-73" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb8-74"><a href="#cb8-74" tabindex="-1"></a>      <span class="at">css =</span> <span class="fu">simulate_css</span>(.env<span class="sc">$</span>chem.cas, age_group, weight, .env<span class="sc">$</span>n_samples)</span>
<span id="cb8-75"><a href="#cb8-75" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb8-76"><a href="#cb8-76" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb8-77"><a href="#cb8-77" tabindex="-1"></a>})</span>
<span id="cb8-78"><a href="#cb8-78" tabindex="-1"></a>simulated_css <span class="ot">&lt;-</span> <span class="fu">setNames</span>(simulated_css, casn)</span>
<span id="cb8-79"><a href="#cb8-79" tabindex="-1"></a></span>
<span id="cb8-80"><a href="#cb8-80" tabindex="-1"></a><span class="co"># Remove CASN that failed simulate_css</span></span>
<span id="cb8-81"><a href="#cb8-81" tabindex="-1"></a>casn_keep <span class="ot">&lt;-</span> <span class="fu">map_lgl</span>(simulated_css, <span class="cf">function</span>(df) {</span>
<span id="cb8-82"><a href="#cb8-82" tabindex="-1"></a>  <span class="sc">!</span>(<span class="fu">length</span>(df<span class="sc">$</span>css[[<span class="dv">1</span>]]) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;&amp;</span> <span class="fu">is.na</span>(df<span class="sc">$</span>css[[<span class="dv">1</span>]]))</span>
<span id="cb8-83"><a href="#cb8-83" tabindex="-1"></a>})</span>
<span id="cb8-84"><a href="#cb8-84" tabindex="-1"></a>simulated_css <span class="ot">&lt;-</span> simulated_css[casn_keep]</span>
<span id="cb8-85"><a href="#cb8-85" tabindex="-1"></a></span>
<span id="cb8-86"><a href="#cb8-86" tabindex="-1"></a><span class="co"># Get median `C_ss` values for each age_group</span></span>
<span id="cb8-87"><a href="#cb8-87" tabindex="-1"></a>simulated_css <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb8-88"><a href="#cb8-88" tabindex="-1"></a>  simulated_css,</span>
<span id="cb8-89"><a href="#cb8-89" tabindex="-1"></a>  <span class="cf">function</span>(cas_df) {</span>
<span id="cb8-90"><a href="#cb8-90" tabindex="-1"></a>    cas_df <span class="sc">|&gt;</span></span>
<span id="cb8-91"><a href="#cb8-91" tabindex="-1"></a>      <span class="fu">nest</span>(<span class="at">.by =</span> age_group) <span class="sc">|&gt;</span></span>
<span id="cb8-92"><a href="#cb8-92" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb8-93"><a href="#cb8-93" tabindex="-1"></a>        <span class="at">age_median_css =</span> <span class="fu">map_dbl</span>(data, <span class="cf">function</span>(df) <span class="fu">median</span>(<span class="fu">unlist</span>(df<span class="sc">$</span>css),</span>
<span id="cb8-94"><a href="#cb8-94" tabindex="-1"></a>                                                           <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-95"><a href="#cb8-95" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb8-96"><a href="#cb8-96" tabindex="-1"></a>      <span class="fu">unnest</span>(data)</span>
<span id="cb8-97"><a href="#cb8-97" tabindex="-1"></a>  }</span>
<span id="cb8-98"><a href="#cb8-98" tabindex="-1"></a>)</span>
<span id="cb8-99"><a href="#cb8-99" tabindex="-1"></a></span>
<span id="cb8-100"><a href="#cb8-100" tabindex="-1"></a><span class="co"># Get median `C_ss` values for each weight</span></span>
<span id="cb8-101"><a href="#cb8-101" tabindex="-1"></a>simulated_css <span class="ot">&lt;-</span> <span class="fu">map</span>(</span>
<span id="cb8-102"><a href="#cb8-102" tabindex="-1"></a>  simulated_css,</span>
<span id="cb8-103"><a href="#cb8-103" tabindex="-1"></a>  <span class="cf">function</span>(cas_df) {</span>
<span id="cb8-104"><a href="#cb8-104" tabindex="-1"></a>    cas_df <span class="sc">|&gt;</span></span>
<span id="cb8-105"><a href="#cb8-105" tabindex="-1"></a>      <span class="fu">nest</span>(<span class="at">.by =</span> weight) <span class="sc">|&gt;</span></span>
<span id="cb8-106"><a href="#cb8-106" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb8-107"><a href="#cb8-107" tabindex="-1"></a>        <span class="at">weight_median_css =</span> <span class="fu">map_dbl</span>(data, <span class="cf">function</span>(df) <span class="fu">median</span>(<span class="fu">unlist</span>(df<span class="sc">$</span>css),</span>
<span id="cb8-108"><a href="#cb8-108" tabindex="-1"></a>                                                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-109"><a href="#cb8-109" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb8-110"><a href="#cb8-110" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">|&gt;</span></span>
<span id="cb8-111"><a href="#cb8-111" tabindex="-1"></a>      <span class="fu">arrange</span>(age_min, weight)</span>
<span id="cb8-112"><a href="#cb8-112" tabindex="-1"></a>  }</span>
<span id="cb8-113"><a href="#cb8-113" tabindex="-1"></a>)</span>
<span id="cb8-114"><a href="#cb8-114" tabindex="-1"></a></span>
<span id="cb8-115"><a href="#cb8-115" tabindex="-1"></a>geo_tox_data<span class="sc">$</span>simulated_css <span class="ot">&lt;-</span> simulated_css</span></code></pre></div>
</div>
</div>
<div id="prune-data" class="section level1">
<h1>Prune data</h1>
<p>Retain only those chemicals found in exposure, dose-response and
<code>C_ss</code> datasets.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>casn_keep <span class="ot">&lt;-</span> <span class="fu">names</span>(geo_tox_data<span class="sc">$</span>simulated_css)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>geo_tox_data<span class="sc">$</span>exposure <span class="ot">&lt;-</span> geo_tox_data<span class="sc">$</span>exposure <span class="sc">|&gt;</span> </span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="fu">filter</span>(casn <span class="sc">%in%</span> casn_keep)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>geo_tox_data<span class="sc">$</span>dose_response <span class="ot">&lt;-</span> geo_tox_data<span class="sc">$</span>dose_response <span class="sc">|&gt;</span> </span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  <span class="fu">filter</span>(casn <span class="sc">%in%</span> casn_keep)</span></code></pre></div>
</div>
<div id="countystate-boundaries" class="section level1">
<h1>County/State boundaries</h1>
<p>Download cartographic boundary files for counties and states from the
<a href="https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html" target="_blank">U.S.
Census Bureau</a>. The geometry data for North Carolina counties and the
state are included in the package data as
<code>geo_tox_data$boundaries</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>county <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;cb_2019_us_county_5m/cb_2019_us_county_5m.shp&quot;</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;cb_2019_us_state_5m/cb_2019_us_state_5m.shp&quot;</span>)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>geo_tox_data<span class="sc">$</span>boundaries <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="at">county =</span> county <span class="sc">|&gt;</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    <span class="fu">filter</span>(STATEFP <span class="sc">==</span> <span class="dv">37</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">FIPS =</span> GEOID, geometry),</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  <span class="at">state =</span> state <span class="sc">|&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>    <span class="fu">filter</span>(STATEFP <span class="sc">==</span> <span class="dv">37</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>    <span class="fu">select</span>(geometry)</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>)</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
